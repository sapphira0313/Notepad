<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notioné£æ ¼å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</title>
    <style>
        :root {
            --bg-color: #fff;
            --text-color: #333;
            --border-color: rgba(55, 53, 47, 0.09);
            --sidebar-bg: #fff;
            --navbar-bg: #fff;
            --hover-bg: rgba(55, 53, 47, 0.08);
            --active-bg: rgba(55, 53, 47, 0.12);
            --text-secondary: rgba(55, 53, 47, 0.6);
            --text-placeholder: rgba(55, 53, 47, 0.4);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --shadow-color-hover: rgba(0, 0, 0, 0.15);
            --control-bg: #f0f0f0;
            --control-border: #ddd;
            --danger-color: #e00;
            --danger-hover: rgba(220, 0, 0, 0.1);
            --primary-color: #007bff;
            --toolbar-bg: rgba(245, 245, 245, 0.8);
            --toolbar-hover: rgba(55, 53, 47, 0.08);
            --toolbar-active: rgba(55, 53, 47, 0.12);
            --editor-bg: #fff;
            --editor-placeholder: rgba(55, 53, 47, 0.4);
            --notion-purple: #7e5cef;
            --notion-pink: #e34077;
            --notion-blue: #3ea1d1;
            --notion-green: #44b491;
            --notion-yellow: #f5c34b;
            --notion-orange: #ed8d47;
            --notion-red: #e15256;
            --notion-gray: #9b9b9b;
            --notion-light-gray: #f0f0f0;
            --notion-dark-gray: #444;
            /* æ·»åŠ æ–‡å­—å¯¹æ¯”è‰²å˜é‡ */
            --editor-text-contrast: #000;
        }
        
        /* ç§»é™¤è‡ªå®šä¹‰çš„æ·±è‰²æ¨¡å¼å˜é‡ï¼Œä½¿ç”¨æµè§ˆå™¨é»˜è®¤ä¸»é¢˜ */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
        }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            font-size: 16px;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            height: 45px;
            background: var(--navbar-bg);
            display: flex;
            align-items: center;
            padding: 0 12px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            font-size: 14px;
            box-shadow: 0 1px 0 var(--border-color);
        }

        .nav-left {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .logo {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-color);
        }

        /* ä¸»è¦å¸ƒå±€ */
        .app-container {
            display: flex;
            height: 100vh;
            padding-top: 45px;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 240px;
            background: var(--sidebar-bg);
            overflow-y: auto;
            padding: 16px 0;
            flex-shrink: 0;
            font-size: 16px;
            border-right: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 0 16px 8px;
            margin-bottom: 8px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .new-page-btn {
            width: 100%;
            background: none;
            border: none;
            text-align: left;
            padding: 8px 16px;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            position: relative;
            transition: all 0.2s ease;
        }

        .new-page-btn:hover {
            background: var(--hover-bg);
            opacity: 1;
        }

        .new-page-btn::before {
            content: "+";
            margin-right: 8px;
            font-size: 18px;
        }

        .pages-list {
            margin-top: 8px;
        }

        .page-item {
            padding: 6px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            margin: 0 4px;
            display: flex;
            align-items: center;
            color: var(--text-color);
            position: relative;
            transition: all 0.2s ease;
        }

        .page-item:hover {
            background: var(--hover-bg);
        }

        .page-item.active {
            background: var(--active-bg);
            font-weight: 500;
        }

        .page-item::before {
            content: "ğŸ“„";
            margin-right: 8px;
            font-size: 12px;
        }

        .page-actions {
            margin-left: auto;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .page-item:hover .page-actions {
            opacity: 1;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 12px;
            position: relative;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            background: var(--danger-hover);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .page-header {
            padding: 32px 10% 8px;
        }

        .page-title-input {
            width: 100%;
            font-size: 40px;
            font-weight: 700;
            border: none;
            outline: none;
            background: transparent;
            color: var(--text-color);
            font-family: inherit;
            line-height: 1.2;
            transition: all 0.2s ease;
        }

        .page-title-input::placeholder {
            color: var(--text-placeholder);
        }

        .page-title-input:focus {
            box-shadow: 0 1px 0 0 var(--border-color);
        }

        /* å­—æ•°ç»Ÿè®¡ */
        #wordCount {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            padding: 4px 0;
        }

        .editor-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px 10%;
            background: var(--bg-color);
        }

        /* è‡ªå®šä¹‰ç¼–è¾‘å™¨å·¥å…·æ æ ·å¼ - Notioné£æ ¼ */
        .editor-toolbar {
            background: var(--toolbar-bg);
            backdrop-filter: blur(10px);
            border-radius: 6px;
            padding: 4px;
            margin-bottom: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
            transition: all 0.2s ease;
            justify-content: flex-start;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            margin-right: 4px;
            padding-right: 4px;
            border-right: 1px solid var(--border-color);
        }

        .toolbar-group:last-child {
            border-right: none;
            margin-right: 0;
            padding-right: 0;
        }
        
        /* å·¥å…·æ åˆ†ç»„é—´è·ä¼˜åŒ– */
        .toolbar-group:not(:last-child) {
            margin-right: 8px;
        }

        .toolbar-btn {
            background: none;
            border: none;
            border-radius: 4px;
            padding: 6px 8px;
            margin: 0 1px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            min-width: 32px;
            height: 32px;
            opacity: 0.7;
        }

        .toolbar-btn:hover {
            background: var(--toolbar-hover);
            opacity: 1;
            transform: translateY(-1px);
        }

        .toolbar-btn.active {
            background: var(--toolbar-active);
            opacity: 1;
            font-weight: bold;
        }

        .toolbar-btn i {
            font-style: normal;
            font-weight: bold;
        }

        .toolbar-separator {
            width: 1px;
            background: var(--border-color);
            margin: 0 4px;
            height: 20px;
        }

        .color-picker {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: var(--control-bg);
            margin: 0 2px;
            transition: all 0.2s ease;
        }

        .color-picker:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        /* è‡ªå®šä¹‰ç¼–è¾‘å™¨æ ·å¼ - Notioné£æ ¼ */
        .custom-editor {
            min-height: 500px;
            padding: 16px 0;
            outline: none;
            background: var(--bg-color); /* ä½¿ç”¨æµè§ˆå™¨é»˜è®¤èƒŒæ™¯ */
            color: var(--text-color); /* ä½¿ç”¨æµè§ˆå™¨é»˜è®¤æ–‡å­—é¢œè‰² */
            font-size: 16px;
            line-height: 1.5;
            caret-color: var(--text-color); /* å…‰æ ‡é¢œè‰²ä¸æ–‡å­—é¢œè‰²ä¸€è‡´ */
            max-width: 700px;
            margin: 0 auto;
            transition: all 0.2s ease;
        }

        .custom-editor:focus {
            /* ç§»é™¤ç„¦ç‚¹è¾¹æ¡†ï¼Œä½¿ç”¨æ›´è‡ªç„¶çš„æ ·å¼ */
        }

        .custom-editor:empty::before {
            content: "ç©ºè¡Œ... æŒ‰ '/' æŸ¥çœ‹å‘½ä»¤";
            color: var(--text-placeholder);
            font-style: normal;
            pointer-events: none;
        }

        /* ç¼–è¾‘å™¨å†…å®¹æ ·å¼ */
        .custom-editor p {
            margin: 0 0 4px 0;
            line-height: 1.5;
        }

        .custom-editor h1,
        .custom-editor h2,
        .custom-editor h3 {
            margin: 16px 0 4px 0;
            font-weight: 600;
            line-height: 1.3;
        }

        .custom-editor h1 {
            font-size: 32px;
        }

        .custom-editor h2 {
            font-size: 24px;
        }

        .custom-editor h3 {
            font-size: 20px;
        }

        .custom-editor ul,
        .custom-editor ol {
            padding-left: 24px;
            margin: 8px 0;
        }

        .custom-editor li {
            margin: 4px 0;
        }

        .custom-editor strong {
            font-weight: 600;
        }

        .custom-editor em {
            font-style: italic;
        }

        .custom-editor u {
            text-decoration: underline;
        }

        .custom-editor a {
            color: #007bff;
            text-decoration: underline;
        }

        @media (prefers-color-scheme: dark) {
            .custom-editor a {
                color: #4da6ff;
            }
        }

        /* å›¾ç‰‡æ ·å¼ - Notioné£æ ¼ */
        .custom-editor img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 12px 0;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .custom-editor img:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* å›¾ç‰‡é€‰ä¸­çŠ¶æ€ */
        .custom-editor img.selected {
            outline: 2px solid var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-color);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            .page-header, .editor-container {
                padding: 32px 5% 8px;
            }
            
            .custom-editor {
                min-height: 400px;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 0;
                overflow: hidden;
            }
            .page-header, .editor-container {
                padding: 24px 3% 8px;
            }
            
            .editor-toolbar {
                padding: 2px;
            }
            
            .toolbar-btn {
                padding: 4px 6px;
                font-size: 13px;
                min-width: 28px;
                height: 28px;
            }
            
            .custom-editor {
                min-height: 300px;
                padding: 12px 0;
            }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(55, 53, 47, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(55, 53, 47, 0.3);
        }

        @media (prefers-color-scheme: dark) {
            ::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.2);
            }

            ::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.3);
            }
        }
        
        /* SVGå›¾æ ‡æ ·å¼ */
        .toolbar-btn svg {
            width: 16px;
            height: 16px;
        }
        
        /* Quillé£æ ¼å›¾æ ‡æ ·å¼ */
        .ql-stroke {
            fill: none;
            stroke: currentColor;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 2;
        }
        
        .ql-fill {
            fill: currentColor;
        }
        
        /* å›¾æ ‡æ‚¬åœæ•ˆæœ */
        .toolbar-btn:hover svg {
            transform: scale(1.1);
            transition: all 0.2s ease;
        }
        
        /* æ´»è·ƒçŠ¶æ€å›¾æ ‡ */
        .toolbar-btn.active .ql-stroke {
            stroke: var(--primary-color);
        }
        
        .toolbar-btn.active .ql-fill {
            fill: var(--primary-color);
        }
        
        /* ä¼˜åŒ–Notioné£æ ¼å¤–è§‚ */
        .empty-state {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }
        
        .empty-state-content h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-color);
        }
        
        .empty-state-content p {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }
        
        /* é¡µé¢åˆ—è¡¨ä¼˜åŒ– */
        .page-item {
            transition: all 0.2s ease;
        }
        
        /* æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .new-page-btn {
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        /* ç¼–è¾‘å™¨å†…å®¹ä¼˜åŒ– */
        .custom-editor {
            font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
        }
        
        /* æ ‡é¢˜æ ·å¼ä¼˜åŒ– */
        .custom-editor h1 {
            font-size: 40px;
            line-height: 1.2;
            margin-top: 24px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .custom-editor h2 {
            font-size: 32px;
            line-height: 1.2;
            margin-top: 20px;
            margin-bottom: 6px;
            font-weight: 600;
        }
        
        .custom-editor h3 {
            font-size: 24px;
            line-height: 1.2;
            margin-top: 16px;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        /* åˆ—è¡¨æ ·å¼ä¼˜åŒ– */
        .custom-editor ul, .custom-editor ol {
            padding-left: 32px;
        }
        
        .custom-editor li {
            margin: 2px 0;
        }
        
        /* é“¾æ¥æ ·å¼ä¼˜åŒ– */
        .custom-editor a {
            color: #007bff;
            text-decoration: none;
            border-bottom: 1px solid rgba(0, 123, 255, 0.3);
            transition: all 0.2s ease;
        }
        
        .custom-editor a:hover {
            border-bottom: 1px solid #007bff;
        }
        
        @media (prefers-color-scheme: dark) {
            .custom-editor a {
                color: #4da6ff;
                border-bottom: 1px solid rgba(77, 166, 255, 0.3);
            }
            
            .custom-editor a:hover {
                border-bottom: 1px solid #4da6ff;
            }
        }
        
        /* Notioné£æ ¼é¢œè‰²æŒ‰é’® */
        .color-btn {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid transparent;
            cursor: pointer;
            margin: 0 2px;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .color-btn:hover {
            transform: scale(1.2);
            border-color: var(--border-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .color-btn.purple { background-color: var(--notion-purple); }
        .color-btn.pink { background-color: var(--notion-pink); }
        .color-btn.blue { background-color: var(--notion-blue); }
        .color-btn.green { background-color: var(--notion-green); }
        .color-btn.yellow { background-color: var(--notion-yellow); }
        .color-btn.orange { background-color: var(--notion-orange); }
        .color-btn.red { background-color: var(--notion-red); }
        .color-btn.gray { background-color: var(--notion-gray); }
        
        /* Notioné£æ ¼ä»£ç å— */
        .custom-editor pre {
            background: var(--control-bg);
            border-radius: 4px;
            padding: 12px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 12px 0;
        }
        
        @media (prefers-color-scheme: dark) {
            .custom-editor pre {
                background: #333;
            }
        }
        
        /* Notioné£æ ¼å¼•ç”¨å— */
        .custom-editor blockquote {
            border-left: 3px solid var(--notion-gray);
            padding-left: 16px;
            margin: 12px 0;
            color: var(--text-secondary);
        }
        
        /* Notioné£æ ¼åˆ†éš”çº¿ */
        .custom-editor hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 24px 0;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        /* æ‚¬åœæ•ˆæœ */
        .page-item, .new-page-btn, .toolbar-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* é¡µé¢é¡¹æ‚¬åœæ•ˆæœ */
        .page-item:hover {
            transform: translateX(2px);
        }
        
        /* Notioné£æ ¼è¡¨æ ¼ */
        .custom-editor table {
            border-collapse: collapse;
            width: 100%;
            margin: 12px 0;
        }
        
        .custom-editor table th,
        .custom-editor table td {
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            text-align: left;
        }
        
        .custom-editor table th {
            background-color: var(--notion-light-gray);
            font-weight: 600;
        }
        
        /* Notioné£æ ¼å¾…åŠäº‹é¡¹ */
        .custom-editor .todo-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        
        .custom-editor .todo-checkbox {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            cursor: pointer;
        }
        
        .custom-editor .todo-text {
            flex: 1;
        }
        
        .custom-editor .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: var(--text-secondary);
        }
        
        /* Notioné£æ ¼å¡ç‰‡ */
        .custom-editor .notion-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            background: var(--toolbar-bg);
        }
        
        /* Notioné£æ ¼æ ‡ç­¾ */
        .custom-editor .notion-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin: 0 4px;
            background: var(--notion-light-gray);
        }
        
        /* Notioné£æ ¼Callout */
        .custom-editor .notion-callout {
            display: flex;
            align-items: flex-start;
            padding: 12px 16px;
            border-radius: 4px;
            background: var(--notion-light-gray);
            margin: 12px 0;
        }
        
        .custom-editor .notion-callout-icon {
            margin-right: 12px;
            font-size: 18px;
        }
        
        .custom-editor .notion-callout-content {
            flex: 1;
        }
        
        /* Notioné£æ ¼åˆ‡æ¢åˆ—è¡¨ */
        .custom-editor .toggle-list {
            margin: 4px 0;
        }
        
        .custom-editor .toggle-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 2px 0;
        }
        
        .custom-editor .toggle-icon {
            margin-right: 8px;
            transition: transform 0.2s ease;
        }
        
        .custom-editor .toggle-icon.expanded {
            transform: rotate(90deg);
        }
        
        .custom-editor .toggle-content {
            margin-left: 24px;
            display: none;
        }
        
        .custom-editor .toggle-content.expanded {
            display: block;
        }
        
        /* Notioné£æ ¼åˆ†éš”ç¬¦ */
        .custom-editor .notion-divider {
            height: 1px;
            background: var(--border-color);
            margin: 24px 0;
        }
        
        /* Notioné£æ ¼æŒ‰é’® */
        .custom-editor .notion-button {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            background: var(--notion-blue);
            color: white;
            font-size: 14px;
            cursor: pointer;
            border: none;
            margin: 4px 0;
        }
        
        .custom-editor .notion-button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-left">
            <div class="logo">Notionè®°äº‹æœ¬</div>
        </div>
    </nav>
    
    <!-- ä¸»è¦å†…å®¹ -->
    <div class="app-container">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">å·¥ä½œåŒº</div>
                <button class="new-page-btn" id="newPageBtn">æ–°å»ºé¡µé¢</button>
            </div>
            <div class="pages-list" id="pagesList"></div>
        </aside>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <div class="page-header">
                <input
                    type="text"
                    class="page-title-input"
                    id="pageTitle"
                    placeholder="æœªå‘½å"
                >
                <!-- å­—æ•°ç»Ÿè®¡æ˜¾ç¤ºåŒºåŸŸ -->
                <div id="wordCount">å­—ç¬¦æ•°: 0 | å•è¯æ•°: 0</div>
            </div>
            <div class="editor-container" id="editorContainer">
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-content">
                        <h2>æ¬¢è¿ä½¿ç”¨Notionè®°äº‹æœ¬</h2>
                        <p>åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªé¡µé¢ï¼Œå¼€å§‹è®°å½•æƒ³æ³•ã€åˆ¶å®šè®¡åˆ’æˆ–æ•´ç†ä¿¡æ¯ã€‚</p>
                        <button class="new-page-btn" id="createPageBtn">åˆ›å»ºé¡µé¢</button>
                    </div>
                </div>
                <div id="editorWrapper" style="display: none;">
                    <div id="toolbar" class="editor-toolbar"></div>
                    <div id="editor" class="custom-editor" contenteditable="true"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // é¡µé¢æ•°æ®ç®¡ç†
        let pages = JSON.parse(localStorage.getItem('notepad_pages')) || [];
        let currentPageId = null;

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            initializeToolbar();
            renderPagesList();
            setupEventListeners();
            
            // å¦‚æœæœ‰é¡µé¢ï¼ŒåŠ è½½ç¬¬ä¸€ä¸ªé¡µé¢
            if (pages.length > 0) {
                loadPage(pages[0].id);
            }
        });

        // åˆå§‹åŒ–å·¥å…·æ 
        function initializeToolbar() {
            const toolbar = document.getElementById('toolbar');
            if (!toolbar) return;
            
            toolbar.innerHTML = `
                <div class="toolbar-group">
                    <button class="toolbar-btn" data-command="bold" title="ç²—ä½“">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="none" stroke="currentColor" stroke-width="1.5" d="M6.5 4.5v15M6.5 4.5h4c2.5 0 4.5 2 4.5 4.5s-2 4.5-4.5 4.5h-4M11 13h3.5c2 0 3.5 1.5 3.5 3.5s-1.5 3.5-3.5 3.5h-3.5"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" data-command="italic" title="æ–œä½“">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M10 4v3h1.8l-2 14H8v3h6v-3h-1.8l2-14H16V4h-6v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" data-command="underline" title="ä¸‹åˆ’çº¿">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" data-command="insertUnorderedList" title="é¡¹ç›®ç¬¦å·åˆ—è¡¨">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" data-command="insertOrderedList" title="ç¼–å·åˆ—è¡¨">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M3 5h2v2H3V5zm0 6h2v2H3v-2zm0 6h2v2H3v-2zm4-12h14v2H7V5zm0 6h14v2H7v-2zm0 6h14v2H7v-2z"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-group">
                    <input type="color" class="font-color-picker" title="å­—ä½“é¢œè‰²" value="#000000">
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" data-command="createLink" title="æ’å…¥é“¾æ¥">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5zm-6 8H7c-1.65 0-3 1.35-3 3s1.35 3 3 3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-2zm-3-4h6v2H8v-2z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" data-command="insertImage" title="æ’å…¥å›¾ç‰‡">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z"/>
                        </svg>
                    </button>
                </div>
            `;
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ–°å»ºé¡µé¢æŒ‰é’®
            document.getElementById('newPageBtn')?.addEventListener('click', createNewPage);
            document.getElementById('createPageBtn')?.addEventListener('click', createNewPage);
            
            // é¡µé¢æ ‡é¢˜è¾“å…¥
            document.getElementById('pageTitle')?.addEventListener('input', updatePageTitle);
            
            // å·¥å…·æ æŒ‰é’®
            document.getElementById('toolbar')?.addEventListener('click', function(e) {
                const btn = e.target.closest('.toolbar-btn');
                if (btn && btn.dataset.command) {
                    handleToolbarCommand(btn.dataset.command);
                }
            });
            
            // å­—ä½“é¢œè‰²é€‰æ‹©å™¨
            document.querySelector('.font-color-picker')?.addEventListener('input', function(e) {
                const color = e.target.value;
                applyFontColor(color);
            });
            
            // ç¼–è¾‘å™¨å†…å®¹å˜åŒ–
            document.getElementById('editor')?.addEventListener('input', function() {
                saveCurrentPage();
                updateWordCount();
            });
            
            // ç¼–è¾‘å™¨ç„¦ç‚¹äº‹ä»¶
            document.getElementById('editor')?.addEventListener('focus', updateToolbarButtonState);
            document.getElementById('editor')?.addEventListener('blur', updateToolbarButtonState);
            
            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', function(e) {
                // Ctrl+B ç²—ä½“
                if (e.ctrlKey && e.key === 'b') {
                    e.preventDefault();
                    document.execCommand('bold', false, null);
                    updateToolbarButtonState();
                }
                // Ctrl+I æ–œä½“
                if (e.ctrlKey && e.key === 'i') {
                    e.preventDefault();
                    document.execCommand('italic', false, null);
                    updateToolbarButtonState();
                }
                // Ctrl+U ä¸‹åˆ’çº¿
                if (e.ctrlKey && e.key === 'u') {
                    e.preventDefault();
                    document.execCommand('underline', false, null);
                    updateToolbarButtonState();
                }
            });
            
            // ç¼–è¾‘å™¨ç‚¹å‡»äº‹ä»¶ï¼ˆå¤„ç†åˆ‡æ¢åˆ—è¡¨ç­‰äº¤äº’å…ƒç´ ï¼‰
            document.getElementById('editor')?.addEventListener('click', function(e) {
                // å¤„ç†åˆ‡æ¢åˆ—è¡¨
                const toggleHeader = e.target.closest('.toggle-header');
                if (toggleHeader) {
                    const icon = toggleHeader.querySelector('.toggle-icon');
                    const content = toggleHeader.nextElementSibling;
                    
                    icon.classList.toggle('expanded');
                    content.classList.toggle('expanded');
                }
            });
        }

        // å¤„ç†å·¥å…·æ å‘½ä»¤
        function handleToolbarCommand(command) {
            switch (command) {
                case 'createLink':
                    const url = prompt('è¯·è¾“å…¥é“¾æ¥åœ°å€:');
                    if (url) {
                        document.execCommand('createLink', false, url);
                    }
                    break;
                case 'insertImage':
                    const imgUrl = prompt('è¯·è¾“å…¥å›¾ç‰‡åœ°å€:');
                    if (imgUrl) {
                        document.execCommand('insertImage', false, imgUrl);
                    }
                    break;
                default:
                    document.execCommand(command, false, null);
            }
            updateToolbarButtonState();
            saveCurrentPage();
        }

        // åº”ç”¨å­—ä½“é¢œè‰²
        function applyFontColor(color) {
            const selection = window.getSelection();
            if (!selection.toString()) {
                alert('è¯·å…ˆé€‰æ‹©è¦æ”¹å˜é¢œè‰²çš„æ–‡æœ¬');
                return;
            }
            
            // ç›´æ¥åº”ç”¨å­—ä½“é¢œè‰²ï¼Œä¸æ”¹å˜èƒŒæ™¯è‰²
            document.execCommand('foreColor', false, color);
            saveCurrentPage();
        }

        // æ›´æ–°å·¥å…·æ æŒ‰é’®çŠ¶æ€
        function updateToolbarButtonState() {
            const buttons = document.querySelectorAll('.toolbar-btn[data-command]');
            buttons.forEach(btn => {
                const command = btn.dataset.command;
                if (command && document.queryCommandState && document.queryCommandState(command)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // åˆ›å»ºæ–°é¡µé¢
        function createNewPage() {
            const newPage = {
                id: Date.now().toString(),
                title: 'æœªå‘½å',
                content: '',
                createdAt: new Date().toISOString()
            };
            
            pages.unshift(newPage);
            savePages();
            renderPagesList();
            loadPage(newPage.id);
        }

        // æ¸²æŸ“é¡µé¢åˆ—è¡¨
        function renderPagesList() {
            const pagesList = document.getElementById('pagesList');
            if (!pagesList) return;
            
            pagesList.innerHTML = pages.map(page => `
                <div class="page-item ${page.id === currentPageId ? 'active' : ''}" data-id="${page.id}">
                    <span>${page.title || 'æœªå‘½å'}</span>
                    <div class="page-actions">
                        <button class="delete-btn" data-id="${page.id}">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
            
            // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const pageId = this.dataset.id;
                    deletePage(pageId);
                });
            });
            
            // æ·»åŠ é¡µé¢é¡¹ç‚¹å‡»äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.page-item').forEach(item => {
                item.addEventListener('click', function() {
                    const pageId = this.dataset.id;
                    loadPage(pageId);
                });
            });
        }

        // åŠ è½½é¡µé¢
        function loadPage(pageId) {
            const page = pages.find(p => p.id === pageId);
            if (!page) return;
            
            currentPageId = pageId;
            
            // æ˜¾ç¤ºç¼–è¾‘å™¨
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('editorWrapper').style.display = 'block';
            
            // è®¾ç½®é¡µé¢æ ‡é¢˜
            document.getElementById('pageTitle').value = page.title || 'æœªå‘½å';
            
            // è®¾ç½®é¡µé¢å†…å®¹
            document.getElementById('editor').innerHTML = page.content || '';
            
            // æ›´æ–°é¡µé¢åˆ—è¡¨
            renderPagesList();
            
            // æ›´æ–°å­—æ•°ç»Ÿè®¡
            updateWordCount();
        }

        // æ›´æ–°é¡µé¢æ ‡é¢˜
        function updatePageTitle() {
            const title = document.getElementById('pageTitle').value;
            const page = pages.find(p => p.id === currentPageId);
            if (page) {
                page.title = title;
                savePages();
                renderPagesList();
            }
        }

        // ä¿å­˜å½“å‰é¡µé¢
        function saveCurrentPage() {
            const page = pages.find(p => p.id === currentPageId);
            if (page) {
                page.content = document.getElementById('editor').innerHTML;
                page.title = document.getElementById('pageTitle').value;
                savePages();
            }
        }

        // åˆ é™¤é¡µé¢
        function deletePage(pageId) {
            if (pages.length <= 1) {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªé¡µé¢');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡µé¢å—ï¼Ÿ')) {
                pages = pages.filter(p => p.id !== pageId);
                savePages();
                renderPagesList();
                
                // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰é¡µé¢ï¼ŒåŠ è½½ç¬¬ä¸€ä¸ªé¡µé¢
                if (pageId === currentPageId) {
                    if (pages.length > 0) {
                        loadPage(pages[0].id);
                    } else {
                        // æ˜¾ç¤ºç©ºçŠ¶æ€
                        document.getElementById('emptyState').style.display = 'flex';
                        document.getElementById('editorWrapper').style.display = 'none';
                        currentPageId = null;
                    }
                }
            }
        }

        // ä¿å­˜é¡µé¢æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function savePages() {
            try {
                localStorage.setItem('notepad_pages', JSON.stringify(pages));
            } catch (e) {
                console.error('ä¿å­˜é¡µé¢æ•°æ®å¤±è´¥:', e);
            }
        }

        // æ›´æ–°å­—æ•°ç»Ÿè®¡
        function updateWordCount() {
            const editor = document.getElementById('editor');
            if (!editor) return;
            
            const text = editor.innerText || '';
            const charCount = text.length;
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            
            document.getElementById('wordCount').textContent = `å­—ç¬¦æ•°: ${charCount} | å•è¯æ•°: ${wordCount}`;
        }
    </script>
</body>
</html>
