<!doctype html>
<html lang="zh-CN" class="bg-neutral-50 text-neutral-900 dark:bg-neutral-900 dark:text-neutral-100">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notion记事本</title>
  <meta name="description" content="一个可在 GitHub Pages 一键部署的 Notion 风临时记事本，支持多笔记、Markdown 预览、自动保存与分享链接，保存为 Markdown 文件。" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%23000'/%3E%3Ctext x='50' y='62' font-size='62' text-anchor='middle' fill='%23fff' font-family='Arial, Helvetica, sans-serif'%3EN%3C/text%3E%3C/svg%3E"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    html, body { height: 100%; }
    .scrollbar-thin { scrollbar-width: thin; }
    .scrollbar-thin::-webkit-scrollbar { width: 8px; height: 8px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 8px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
  </style>
</head>
<body class="h-full bg-neutral-50 text-neutral-900 dark:bg-neutral-900 dark:text-neutral-100">
  <div class="h-full grid grid-cols-1 md:grid-cols-[300px_1fr]">
    <aside class="border-r border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 flex flex-col min-h-0">
      <div class="px-4 pt-4 pb-3 border-b border-neutral-200 dark:border-neutral-700">
        <h1 class="text-xl font-semibold">Notion记事本</h1>
        <p class="text-sm text-neutral-500 dark:text-neutral-400">临时记事 · 本地保存</p>
        <div class="mt-3 flex gap-2 flex-wrap">
          <button id="newBtn" class="px-3 py-1.5 text-sm rounded-xl bg-black text-white hover:opacity-90">新建</button>
          <button id="exportBtn" class="px-3 py-1.5 text-sm rounded-xl border border-neutral-300 dark:border-neutral-600 hover:bg-neutral-50 dark:hover:bg-neutral-700">导出 Markdown</button>
          <label class="px-3 py-1.5 text-sm rounded-xl border border-neutral-300 dark:border-neutral-600 hover:bg-neutral-50 dark:hover:bg-neutral-700 cursor-pointer">
            导入<input id="importInput" type="file" accept=".md" class="hidden" />
          </label>
          <button id="themeToggle" class="px-3 py-1.5 text-sm rounded-xl border border-neutral-300 dark:border-neutral-600 hover:bg-neutral-50 dark:hover:bg-neutral-700">切换主题</button>
        </div>
      </div>
      <div class="p-3">
        <div class="relative">
          <input id="search" placeholder="搜索标题或内容…" class="w-full rounded-xl border border-neutral-300 dark:border-neutral-600 px-3 py-2 pr-9 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900 dark:focus:ring-neutral-200 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100"/>
          <span class="absolute right-3 top-1/2 -translate-y-1/2 text-neutral-400">⌘K</span>
        </div>
      </div>
      <nav id="list" class="flex-1 overflow-auto p-2 space-y-1 scrollbar-thin" aria-label="Notes list"></nav>
      <div class="p-3 text-xs text-neutral-400 border-t border-neutral-200 dark:border-neutral-700">
        本地存储 · 无需登录 · 可分享链接
      </div>
    </aside>

    <main class="min-h-0 flex flex-col">
      <header class="p-4 border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 flex items-center gap-2 flex-wrap">
        <input id="title" class="text-lg md:text-xl font-semibold flex-1 min-w-[200px] outline-none bg-transparent border-b border-transparent focus:border-neutral-900 dark:focus:border-neutral-200" placeholder="无标题文档" />
        <div class="flex items-center gap-2">
          <button id="previewToggle" class="px-3 py-1.5 text-sm rounded-xl border border-neutral-300 dark:border-neutral-600 hover:bg-neutral-50 dark:hover:bg-neutral-700">预览 Markdown</button>
          <button id="shareBtn" class="px-3 py-1.5 text-sm rounded-xl bg-black text-white hover:opacity-90">复制分享链接</button>
          <button id="deleteBtn" class="px-3 py-1.5 text-sm rounded-xl border border-red-200 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30">删除</button>
        </div>
      </header>

      <section class="flex-1 grid grid-rows-1 md:grid-cols-2 gap-0">
        <textarea id="editor" class="md:col-span-2 h-full w-full p-4 resize-none outline-none bg-neutral-50 dark:bg-neutral-900 focus:bg-white dark:focus:bg-neutral-800 text-neutral-900 dark:text-neutral-100" placeholder="# 写点什么吧…\n\n- 支持 Markdown\n- 自动保存到浏览器本地\n- 点击右上角复制分享链接\n- 左侧可管理多笔记"></textarea>
        <article id="preview" class="hidden prose prose-neutral dark:prose-invert max-w-none p-6 overflow-auto bg-white dark:bg-neutral-800 border-t md:border-t-0 md:border-l border-neutral-200 dark:border-neutral-700"></article>
      </section>
    </main>
  </div>

  <template id="itemTemplate">
    <button class="w-full text-left p-3 rounded-xl hover:bg-neutral-100 dark:hover:bg-neutral-700 border border-transparent flex flex-col gap-1 relative">
      <span class="title font-medium truncate"></span>
      <span class="snippet text-xs text-neutral-500 truncate"></span>
      <span class="time text-[11px] text-neutral-400"></span>
    </button>
  </template>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const storeKey = 'notionnote.v1';
    const themeKey = 'notionnote.theme';

    function uid() { return Math.random().toString(36).slice(2, 10); }
    function nowISO() { return new Date().toISOString(); }
    function fmtTime(iso){ const d = new Date(iso); return d.toLocaleString(); }

    function load() { try { return JSON.parse(localStorage.getItem(storeKey)) || { notes: [], active: null }; } catch { return { notes: [], active: null }; } }
    function save(state){ localStorage.setItem(storeKey, JSON.stringify(state)); }
    function getState(){ return load(); }
    function setState(mut){ const s = getState(); mut(s); save(s); renderList(); }

    function createNote({title = '无标题', content = ''} = {}){ return { id: uid(), title, content, updated: nowISO() }; }
    function upsertNote(note){ setState(s => { const i = s.notes.findIndex(n => n.id === note.id); if (i >= 0) s.notes[i] = note; else s.notes.unshift(note); s.active = note.id; }); select(note.id); }
    function removeNote(id){ setState(s => { s.notes = s.notes.filter(n => n.id !== id); if (s.active === id) s.active = s.notes[0]?.id || null; }); select(getState().active); }
    function select(id){ const s = getState(); const note = s.notes.find(n => n.id === id) || s.notes[0]; s.active = note?.id || null; save(s); if (!note){ $('#title').value = ''; $('#editor').value = ''; updatePreview(); highlightActive(null); return; } $('#title').value = note.title; $('#editor').value = note.content; updatePreview(); highlightActive(note.id); }

    function renderList(filter = ''){
      const list = $('#list');
      list.innerHTML = '';
      const { notes, active } = getState();
      const q = filter.trim().toLowerCase();
      const rows = notes.filter(n => !q || n.title.toLowerCase().includes(q) || n.content.toLowerCase().includes(q));
      if (rows.length === 0){ list.innerHTML = `<div class="text-sm text-neutral-500 p-3">没有笔记。点击“新建”开始。</div>`; return; }
      for (const n of rows){
        const node = document.importNode($('#itemTemplate').content, true);
        node.querySelector('.title').textContent = n.title || '无标题';
        node.querySelector('.snippet').textContent = (n.content || '').replace(/\n/g,' ').slice(0, 80);
        node.querySelector('.time').textContent = fmtTime(n.updated);

        const btn = node.querySelector('button');
        btn.dataset.id = n.id;
        btn.addEventListener('click', () => select(n.id));

        const delBtn = document.createElement('button');
        delBtn.textContent = '删除';
        delBtn.className = 'absolute top-2 right-2 text-xs text-red-500 hover:text-red-700';
        delBtn.addEventListener('click', (e) => { e.stopPropagation(); if (confirm('确定删除该笔记吗？')) removeNote(n.id); });
        btn.appendChild(delBtn);

        if (n.id === active) btn.classList.add('bg-neutral-100','dark:bg-neutral-700','border-neutral-200','dark:border-neutral-600');
        list.appendChild(node);
      }
    }

    function highlightActive(id){ $$('#list button').forEach(b => { if (b.dataset.id === id) b.classList.add('bg-neutral-100','dark:bg-neutral-700','border-neutral-200','dark:border-neutral-600'); else b.classList.remove('bg-neutral-100','dark:bg-neutral-700','border-neutral-200','dark:border-neutral-600'); }); }

    function persist(){ const s = getState(); if (!s.active){ const n = createNote({ title: $('#title').value.trim() || '无标题', content: $('#editor').value }); upsertNote(n); return; } const note = s.notes.find(n => n.id === s.active); if (!note) return; note.title = $('#title').value.trim() || '无标题'; note.content = $('#editor').value; note.updated = nowISO(); setState(ss => { const i = ss.notes.findIndex(n => n.id === note.id); ss.notes[i] = note; }); highlightActive(note.id); }

    function bindEditor(){ $('#title').addEventListener('input', persist); $('#editor').addEventListener('input', () => { updatePreview(); persist(); }); setInterval(persist, 30000); }

    function updatePreview(){ const md = $('#editor').value || ''; $('#preview').innerHTML = marked.parse(md, { breaks: true, headerIds: false }); }
    function togglePreview(){ const previewOn = !$('#preview').classList.contains('hidden'); if(previewOn){ $('#previewToggle').textContent = '预览 Markdown'; $('#preview').classList.add('hidden'); $('#editor').classList.add('md:col-span-2'); } else { $('#previewToggle').textContent = '隐藏预览'; $('#preview').classList.remove('hidden'); $('#editor').classList.remove('md:col-span-2'); } }

    function makeShareURL(){ const title = $('#title').value.trim() || '无标题'; const content = $('#editor').value || ''; const payload = { t: title, c: content }; const packed = btoa(unescape(encodeURIComponent(JSON.stringify(payload)))); const url = new URL(location.href); url.searchParams.set('n', packed); return url.toString(); }

    function initTheme(){ const saved = localStorage.getItem(themeKey); const html=document.documentElement; if(saved==='dark') html.classList.add('dark'); else html.classList.remove('dark'); }
    function toggleTheme(){ const html=document.documentElement; const isDark=html.classList.contains('dark'); if(isDark){ html.classList.remove('dark'); localStorage.setItem(themeKey,'light'); } else { html.classList.add('dark'); localStorage.setItem(themeKey,'dark'); } }

    function exportMarkdown(){ persist(); const title = $('#title').value.trim() || '无标题'; const content = $('#editor').value; const blob = new Blob([content], { type: 'text/markdown' }); const a = document.createElement('a'); a.href = URL.createObjectURL
