<!DOCTYPE html>

<html class="bg-neutral-50 text-neutral-900 dark:bg-neutral-900 dark:text-neutral-100" lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Notion风格富文本记事本</title>
<link href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%23000'/%3E%3Ctext x='50' y='62' font-size='62' text-anchor='middle' fill='%23fff' font-family='Arial, Helvetica, sans-serif'%3EN%3C/text%3E%3C/svg%3E" rel="icon"/>
<script src="https://cdn.tailwindcss.com"></script>
<style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body { 
            height: 100%; 
            margin: 0; 
            overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        .scrollbar-thin::-webkit-scrollbar { 
            width: 6px; 
            height: 6px; 
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb { 
            background: #d1d5db; 
            border-radius: 8px; 
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { 
            background: #9ca3af; 
        }
        
        .scrollbar-thin::-webkit-scrollbar-track { 
            background: transparent; 
        }
        
        .notion-editor {
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            padding: 0 96px;
        }
        
        @media (max-width: 768px) {
            .notion-editor {
                padding: 0 24px;
            }
        }
        
        .notion-title {
            font-size: 40px;
            font-weight: 700;
            line-height: 1.2;
            padding: 3px 2px;
            margin-bottom: 20px;
        }
        
        .notion-title:focus {
            outline: none;
            background: rgba(150, 150, 150, 0.1);
            border-radius: 3px;
        }
        
        .note-item.active {
            background: rgba(150, 150, 150, 0.1);
            border-left: 3px solid #3b82f6;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            background: #3a3a3a;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            width: 120px;
            padding: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 100;
        }
        
        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.2);
        }
        
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .dark .color-palette {
            background: #2d3748;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: auto;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 4px 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        .toolbar-btn {
            position: relative;
            padding: 6px;
            border-radius: 4px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }
        
        .toolbar-btn:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .toolbar-btn.active {
            background-color: rgba(59, 130, 246, 0.2);
        }
        
        .note-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        #editor {
            min-height: 400px;
            padding: 16px 2px;
            outline: none;
        }
        
        #editor:focus {
            outline: none;
        }
        
        #editor blockquote {
            border-left: 3px solid #ddd;
            padding-left: 16px;
            margin-left: 0;
            color: #666;
        }
        
        #editor ul, #editor ol {
            padding-left: 32px;
            margin: 8px 0;
        }
        
        #editor ul {
            list-style-type: disc;
        }
        
        #editor ol {
            list-style-type: decimal;
        }
        
        #editor li {
            margin-bottom: 4px;
        }
        
        #editor h1 {
            font-size: 2em;
            font-weight: bold;
            margin: 24px 0 16px;
        }
        
        #editor h2 {
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0 14px;
        }
        
        #editor h3 {
            font-size: 1.17em;
            font-weight: bold;
            margin: 16px 0 12px;
        }
        
        #editor code {
            background-color: rgba(135, 131, 120, 0.15);
            border-radius: 3px;
            padding: 2px 4px;
            font-family: monospace;
            font-size: 85%;
        }
        
        #editor pre {
            background-color: rgba(135, 131, 120, 0.15);
            border-radius: 4px;
            padding: 16px;
            overflow-x: auto;
            margin: 12px 0;
            font-family: monospace;
        }
        
        #editor img {
            max-width: 100%;
            border-radius: 4px;
            margin: 8px 0;
        }
        
        .editor-placeholder::before {
            content: attr(placeholder);
            color: #9ca3af;
            font-size: 16px;
            position: absolute;
            pointer-events: none;
        }
        
        .dark #editor blockquote {
            border-left-color: #555;
            color: #aaa;
        }
        
        .dark #editor code {
            background-color: rgba(100, 100, 100, 0.3);
        }
        
        .dark #editor pre {
            background-color: rgba(100, 100, 100, 0.3);
        }
    </style>
</head>
<body class="h-full bg-neutral-50 text-neutral-900 dark:bg-neutral-900 dark:text-neutral-100">
<div class="h-full flex flex-col">
<header class="border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 py-3 px-6 flex items-center justify-between">
<div class="flex items-center">
<div class="flex items-center mr-8">
<div class="w-8 h-8 bg-black rounded flex items-center justify-center mr-2">
<span class="text-white font-bold">N</span>
</div>
<h1 class="text-xl font-bold">Notion风格富文本记事本</h1>
</div>
</div>
<div class="flex items-center space-x-3">
<button class="p-2 rounded-full hover:bg-neutral-100 dark:hover:bg-neutral-700 transition" id="themeToggle" title="切换主题">
<svg fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="5"></circle>
<line x1="12" x2="12" y1="1" y2="3"></line>
<line x1="12" x2="12" y1="21" y2="23"></line>
<line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line>
<line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line>
<line x1="1" x2="3" y1="12" y2="12"></line>
<line x1="21" x2="23" y1="12" y2="12"></line>
<line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line>
<line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line>
</svg>
</button>
</div>
</header>
<div class="flex-1 flex overflow-hidden">
<!-- 左侧笔记列表 -->
<aside class="w-64 border-r border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 flex flex-col">
<div class="p-4 border-b border-neutral-200 dark:border-neutral-700">
<div class="relative">
<input class="w-full rounded-lg border border-neutral-300 dark:border-neutral-600 px-3 py-2 pr-9 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100" id="searchNotes" placeholder="搜索笔记..." type="text"/>
<svg class="h-4 w-4 absolute right-3 top-1/2 transform -translate-y-1/2 text-neutral-400" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</div>
</div>
<div class="flex-1 overflow-y-auto scrollbar-thin">
<div class="p-2">
<div class="space-y-2" id="notesList">
<div class="text-center py-4 text-sm text-neutral-500" id="emptyNotesMsg">
<p>没有笔记</p>
<button class="mt-2 text-blue-600 hover:underline" id="createFirstNote">创建第一个笔记</button>
</div>
</div>
</div>
</div>
<div class="p-3 text-xs text-neutral-500 dark:text-neutral-400 border-t border-neutral-200 dark:border-neutral-700">
                    本地存储 · 自动保存 · 无需登录
                </div>
</aside>
<!-- 右侧编辑区 -->
<main class="flex-1 flex flex-col overflow-hidden">
<div class="border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 py-2 px-6 flex items-center space-x-3 flex-wrap">
<!-- 新建笔记按钮 -->
<button class="px-3 py-1 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 transition flex items-center" id="newNoteBtn">
<svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
                        新建
                    </button>
<!-- 保存按钮 -->
<button class="px-3 py-1 text-sm rounded bg-green-600 text-white hover:bg-green-700 transition flex items-center" id="saveNoteBtn">
<svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
                        保存
                    </button>
<!-- 导出按钮 -->
<button class="px-3 py-1 text-sm rounded bg-purple-600 text-white hover:bg-purple-700 transition flex items-center" id="exportNoteBtn">
<svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
                        导出
                    </button>
<!-- 删除按钮 -->
<button class="px-3 py-1 text-sm rounded border border-red-200 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 transition flex items-center" id="deleteNoteBtn">
<svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
                        删除
                    </button>
<!-- 状态显示 -->
<div class="ml-auto text-sm text-neutral-500" id="saveStatus">已保存</div>
</div>
<!-- 格式工具栏 -->
<div class="border-b border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 py-2 px-6 flex items-center space-x-2 flex-wrap">
<!-- 文本格式按钮 -->
<div class="tooltip">
<button class="toolbar-btn" id="boldBtn" title="加粗">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
<path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
</svg>
<span class="tooltip-text">加粗</span>
</button>
</div>
<div class="tooltip">
<button class="toolbar-btn" id="italicBtn" title="斜体">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<line x1="19" x2="10" y1="4" y2="4"></line>
<line x1="14" x2="5" y1="20" y2="20"></line>
<line x1="15" x2="9" y1="4" y2="20"></line>
</svg>
<span class="tooltip-text">斜体</span>
</button>
</div>
<div class="tooltip">
<button class="toolbar-btn" id="underlineBtn" title="下划线">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"></path>
<line x1="4" x2="20" y1="21" y2="21"></line>
</svg>
<span class="tooltip-text">下划线</span>
</button>
</div>
<div class="tooltip">
<button class="toolbar-btn" id="strikeBtn" title="删除线">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M17.3 4.9c-2.3-.6-4.4-.5-6.2.3-2.4 1.1-3.3 3-3.3 5.4 0 2.6 2.7 5.4 7 5.4h7"></path>
<line x1="5" x2="19" y1="12" y2="12"></line>
</svg>
<span class="tooltip-text">删除线</span>
</button>
</div>
<!-- 列表按钮 -->
<div class="h-4 border-r border-neutral-200 dark:border-neutral-700 mx-1"></div>
<div class="tooltip">
<button class="toolbar-btn" id="ulBtn" title="项目符号">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<line x1="8" x2="21" y1="6" y2="6"></line>
<line x1="8" x2="21" y1="12" y2="12"></line>
<line x1="8" x2="21" y1="18" y2="18"></line>
<line x1="3" x2="3.01" y1="6" y2="6"></line>
<line x1="3" x2="3.01" y1="12" y2="12"></line>
<line x1="3" x2="3.01" y1="18" y2="18"></line>
</svg>
<span class="tooltip-text">无序列表</span>
</button>
</div>
<div class="tooltip">
<button class="toolbar-btn" id="olBtn" title="编号列表">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<line x1="10" x2="21" y1="6" y2="6"></line>
<line x1="10" x2="21" y1="12" y2="12"></line>
<line x1="10" x2="21" y1="18" y2="18"></line>
<path d="M4 6h1v4H4V6z"></path>
<path d="M4 10h2v6H4v-6z"></path>
<path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path>
</svg>
<span class="tooltip-text">有序列表</span>
</button>
</div>
<!-- 标题格式 -->
<div class="h-4 border-r border-neutral-200 dark:border-neutral-700 mx-1"></div>
<div class="tooltip">
<button class="toolbar-btn" id="h1Btn" title="标题1">
<span class="font-bold">H1</span>
<span class="tooltip-text">标题1</span>
</button>
</div>
<div class="tooltip">
<button class="toolbar-btn" id="h2Btn" title="标题2">
<span class="font-bold">H2</span>
<span class="tooltip-text">标题2</span>
</button>
</div>
<div class="tooltip">
<button class="toolbar-btn" id="h3Btn" title="标题3">
<span class="font-bold">H3</span>
<span class="tooltip-text">标题3</span>
</button>
</div>
<!-- 引用块 -->
<div class="h-4 border-r border-neutral-200 dark:border-neutral-700 mx-1"></div>
<div class="tooltip">
<button class="toolbar-btn" id="quoteBtn" title="引用">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M10 11h-4a1 1 0 0 1 -1 -1v-3a1 1 0 0 1 1 -1h3a1 1 0 0 1 1 1v6c0 2.667 -1.333 4.333 -4 5"></path>
<path d="M19 11h-4a1 1 0 0 1 -1 -1v-3a1 1 0 0 1 1 -1h3a1 1 0 0 1 1 1v6c0 2.667 -1.333 4.333 -4 5"></path>
</svg>
<span class="tooltip-text">引用</span>
</button>
</div>
<!-- 代码块 -->
<div class="h-4 border-r border-neutral-200 dark:border-neutral-700 mx-1"></div>
<div class="tooltip">
<button class="toolbar-btn" id="codeBtn" title="代码块">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<polyline points="16 18 22 12 16 6"></polyline>
<polyline points="8 6 2 12 8 18"></polyline>
</svg>
<span class="tooltip-text">代码块</span>
</button>
</div>
<!-- 颜色选择 -->
<div class="h-4 border-r border-neutral-200 dark:border-neutral-700 mx-1"></div>
<div class="tooltip relative">
<button class="toolbar-btn" id="colorBtn" title="文本颜色">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M5 9l-3 3 3 3"></path>
<path d="M9 5l3-3 3 3"></path>
<circle cx="17" cy="17" r="3"></circle>
<path d="M21 15h-2.5a1.5 1.5 0 0 0 0 3h1a1.5 1.5 0 0 1 0 3H12"></path>
</svg>
<span class="tooltip-text">文本颜色</span>
</button>
<div class="color-palette hidden dark:bg-neutral-800" id="colorPalette">
<div class="color-option bg-red-500" data-color="red"></div>
<div class="color-option bg-blue-500" data-color="blue"></div>
<div class="color-option bg-green-500" data-color="green"></div>
<div class="color-option bg-yellow-500" data-color="yellow"></div>
<div class="color-option bg-purple-500" data-color="purple"></div>
<div class="color-option bg-pink-500" data-color="pink"></div>
<div class="color-option bg-orange-500" data-color="orange"></div>
<div class="color-option bg-teal-500" data-color="teal"></div>
</div>
</div>
<!-- 插入图片按钮 -->
<div class="h-4 border-r border-neutral-200 dark:border-neutral-700 mx-1"></div>
<div class="tooltip">
<button class="toolbar-btn" id="imageBtn" title="插入图片">
<svg fill="none" height="18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<rect height="18" rx="2" ry="2" width="18" x="3" y="3"></rect>
<circle cx="8.5" cy="8.5" r="1.5"></circle>
<path d="M21 15l-5-5L5 21"></path>
</svg>
<span class="tooltip-text">插入图片</span>
</button>
</div>
</div>
<div class="flex-1 overflow-y-auto scrollbar-thin">
<div class="notion-editor py-8">
<div class="notion-title" contenteditable="true" id="noteTitle" placeholder="无标题文档">欢迎使用富文本记事本</div>
<div class="w-full min-h-[400px] p-2 resize-none bg-transparent text-neutral-900 dark:text-neutral-100" contenteditable="true" id="editor" placeholder="开始输入内容..."></div>
</div>
</div>
</main>
</div>
</div>
<!-- 图片插入模态框 -->
<div class="image-modal hidden" id="imageModal">
<div class="bg-white dark:bg-neutral-800 rounded-lg p-6 w-full max-w-md">
<h3 class="text-lg font-medium mb-4">插入图片</h3>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">图片URL</label>
<input class="w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700" id="imageUrl" placeholder="https://example.com/image.jpg" type="text"/>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-1">图片描述</label>
<input class="w-full px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-700" id="imageAlt" placeholder="图片描述" type="text"/>
</div>
<div class="flex justify-end space-x-2">
<button class="px-4 py-2 rounded-lg border border-neutral-300 dark:border-neutral-600 hover:bg-neutral-100 dark:hover:bg-neutral-700" id="cancelImageBtn">取消</button>
<button class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700" id="insertImageBtn">插入</button>
</div>
</div>
</div>
<!-- Toast通知容器 -->
<div id="toastContainer"></div>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            // 状态管理
            const state = {
                notes: JSON.parse(localStorage.getItem('rt-notes')) || [],
                activeNoteId: null
            };
            
            // DOM 元素
            const dom = {
                notesList: document.getElementById('notesList'),
                noteTitle: document.getElementById('noteTitle'),
                editor: document.getElementById('editor'),
                newNoteBtn: document.getElementById('newNoteBtn'),
                saveNoteBtn: document.getElementById('saveNoteBtn'),
                exportNoteBtn: document.getElementById('exportNoteBtn'),
                deleteNoteBtn: document.getElementById('deleteNoteBtn'),
                saveStatus: document.getElementById('saveStatus'),
                themeToggle: document.getElementById('themeToggle'),
                searchNotes: document.getElementById('searchNotes'),
                createFirstNote: document.getElementById('createFirstNote'),
                emptyNotesMsg: document.getElementById('emptyNotesMsg'),
                toastContainer: document.getElementById('toastContainer'),
                boldBtn: document.getElementById('boldBtn'),
                italicBtn: document.getElementById('italicBtn'),
                underlineBtn: document.getElementById('underlineBtn'),
                strikeBtn: document.getElementById('strikeBtn'),
                ulBtn: document.getElementById('ulBtn'),
                olBtn: document.getElementById('olBtn'),
                h1Btn: document.getElementById('h1Btn'),
                h2Btn: document.getElementById('h2Btn'),
                h3Btn: document.getElementById('h3Btn'),
                quoteBtn: document.getElementById('quoteBtn'),
                codeBtn: document.getElementById('codeBtn'),
                colorBtn: document.getElementById('colorBtn'),
                colorPalette: document.getElementById('colorPalette'),
                imageBtn: document.getElementById('imageBtn'),
                imageModal: document.getElementById('imageModal'),
                imageUrl: document.getElementById('imageUrl'),
                imageAlt: document.getElementById('imageAlt'),
                cancelImageBtn: document.getElementById('cancelImageBtn'),
                insertImageBtn: document.getElementById('insertImageBtn')
            };
            
            // 初始化应用
            function init() {
                // 设置主题
                if (localStorage.getItem('theme') === 'dark' || 
                    (window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('theme'))) {
                    document.documentElement.classList.add('dark');
                }
                
                // 渲染笔记列表
                renderNotesList();
                
                // 如果有笔记，激活第一个
                if (state.notes.length > 0) {
                    activateNote(state.notes[0].id);
                } else {
                    // 没有笔记时的状态
                    createDefaultNote();
                }
            }
            
            // 创建默认笔记
            function createDefaultNote() {
                const newNote = {
                    id: Date.now().toString(),
                    title: '欢迎使用富文本记事本',
                    content: '<div><h1>欢迎使用富文本记事本</h1><p>这是一个所见即所得的富文本笔记工具，所有数据都保存在您的浏览器本地。</p><h2>功能特点</h2><ul><li><strong>富文本编辑</strong>：使用工具栏按钮格式化文本</li><li><em>即时所见即所得</em>：编辑内容实时显示最终效果</li><li><u>图片插入</u>：支持插入网络图片</li><li><span style="color:blue;">多彩文本</span>：支持多种文本颜色</li><li>多笔记管理：左侧可创建和管理多个笔记</li><li>导出功能：可将笔记导出为HTML文件</li><li>深色模式：支持深色/浅色主题切换</li></ul><h2>使用说明</h2><p>1. 使用工具栏按钮格式化文本：</p><ul><li><strong>加粗</strong>：选中文本后点击 <strong>B</strong> 按钮</li><li><em>斜体</em>：选中文本后点击 <em>I</em> 按钮</li><li><u>下划线</u>：选中文本后点击 <u>U</u> 按钮</li><li><s>删除线</s>：选中文本后点击 <s>S</s> 按钮</li><li>文本颜色：点击调色板按钮</li></ul><p>2. 插入图片：</p><ul><li>点击图片按钮</li><li>输入图片URL和描述</li><li>点击插入按钮</li></ul><p>3. 管理笔记：</p><ul><li>点击"新建"创建新笔记</li><li>点击"保存"保存当前笔记</li><li>点击"导出"导出为HTML文件</li><li>点击"删除"删除当前笔记</li></ul><h2>示例图片</h2><p><img src="https://upload.wikimedia.org/wikipedia/commons/4/45/Notion_app_logo.png" alt="Notion Logo" style="max-width: 200px;"></p></div>',
                    created: new Date().toISOString(),
                    updated: new Date().toISOString()
                };
                
                state.notes.push(newNote);
                saveNotes();
                activateNote(newNote.id);
                renderNotesList();
            }
            
            // 渲染笔记列表
            function renderNotesList(filter = '') {
                dom.notesList.innerHTML = '';
                
                if (state.notes.length === 0) {
                    dom.emptyNotesMsg.style.display = 'block';
                    return;
                }
                
                dom.emptyNotesMsg.style.display = 'none';
                
                const filteredNotes = filter 
                    ? state.notes.filter(note => 
                        note.title.toLowerCase().includes(filter.toLowerCase()) || 
                        note.content.toLowerCase().includes(filter.toLowerCase()))
                    : state.notes;
                
                if (filteredNotes.length === 0) {
                    dom.notesList.innerHTML = `
                        <div class="text-center py-4 text-sm text-neutral-500">
                            没有找到匹配的笔记
                        </div>
                    `;
                    return;
                }
                
                filteredNotes.forEach(note => {
                    const noteEl = document.createElement('div');
                    noteEl.className = `note-item note-card p-3 rounded-lg cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700 transition ${note.id === state.activeNoteId ? 'active' : ''}`;
                    noteEl.dataset.id = note.id;
                    
                    // 创建临时元素用于提取文本内容
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = note.content;
                    const textContent = tempDiv.textContent || tempDiv.innerText;
                    
                    // 截取内容预览
                    const contentPreview = textContent.substring(0, 100);
                    
                    noteEl.innerHTML = `
                        <div class="font-medium truncate flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-neutral-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            ${note.title || '无标题'}
                        </div>
                        <div class="text-xs text-neutral-500 dark:text-neutral-400 truncate mt-1 ml-6">${contentPreview}</div>
                        <div class="text-[10px] text-neutral-400 mt-2 ml-6">${formatDate(note.updated)}</div>
                    `;
                    
                    noteEl.addEventListener('click', () => activateNote(note.id));
                    dom.notesList.appendChild(noteEl);
                });
            }
            
            // 激活笔记
            function activateNote(noteId) {
                const note = state.notes.find(n => n.id === noteId);
                if (!note) return;
                
                state.activeNoteId = noteId;
                
                // 更新UI
                dom.noteTitle.textContent = note.title;
                dom.editor.innerHTML = note.content;
                
                // 高亮活动笔记
                document.querySelectorAll('.note-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.id === noteId);
                });
                
                // 更新状态显示
                dom.saveStatus.textContent = '已加载';
            }
            
            // 创建新笔记
            function createNewNote() {
                const newNote = {
                    id: Date.now().toString(),
                    title: '新笔记',
                    content: '<h1>新笔记</h1><p>开始记录您的想法...</p>',
                    created: new Date().toISOString(),
                    updated: new Date().toISOString()
                };
                
                state.notes.unshift(newNote);
                saveNotes();
                renderNotesList();
                activateNote(newNote.id);
                
                // 显示创建成功消息
                showToast('已创建新笔记');
            }
            
            // 保存当前笔记
            function saveCurrentNote() {
                if (!state.activeNoteId) return;
                
                const noteIndex = state.notes.findIndex(n => n.id === state.activeNoteId);
                if (noteIndex === -1) return;
                
                state.notes[noteIndex].title = dom.noteTitle.textContent || '无标题';
                state.notes[noteIndex].content = dom.editor.innerHTML;
                state.notes[noteIndex].updated = new Date().toISOString();
                
                saveNotes();
                renderNotesList();
                
                // 更新状态显示
                dom.saveStatus.textContent = `已保存 ${new Date().toLocaleTimeString()}`;
                showToast('笔记已保存');
            }
            
            // 导出当前笔记为HTML
            function exportCurrentNote() {
                if (!state.activeNoteId) {
                    showToast('请先选择笔记');
                    return;
                }
                
                const note = state.notes.find(n => n.id === state.activeNoteId);
                if (!note) return;
                
                // 创建HTML文件
                const filename = (note.title || '未命名笔记').replace(/[^\w\u4e00-\u9fa5]/g, '_') + '.html';
                const content = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>${note.title || '导出笔记'}</title>
                        <style>
                            body {
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
                                max-width: 800px;
                                margin: 0 auto;
                                padding: 20px;
                                line-height: 1.6;
                            }
                            h1 { font-size: 2em; margin: 24px 0 16px; }
                            h2 { font-size: 1.5em; margin: 20px 0 14px; }
                            h3 { font-size: 1.17em; margin: 16px 0 12px; }
                            ul, ol { padding-left: 32px; margin: 8px 0; }
                            li { margin-bottom: 4px; }
                            img { max-width: 100%; border-radius: 4px; margin: 8px 0; }
                            pre {
                                background-color: #f5f5f5;
                                border-radius: 4px;
                                padding: 16px;
                                overflow-x: auto;
                                margin: 12px 0;
                                font-family: monospace;
                            }
                            blockquote {
                                border-left: 3px solid #ddd;
                                padding-left: 16px;
                                margin-left: 0;
                                color: #666;
                            }
                        </style>
                    </head>
                    <body>
                        <h1>${note.title || '无标题'}</h1>
                        ${note.content}
                    </body>
                    </html>
                `;
                
                // 创建Blob对象
                const blob = new Blob([content], { type: 'text/html' });
                
                // 创建下载链接
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                
                // 触发下载
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast(`已导出: ${filename}`);
            }
            
            // 删除当前笔记
            function deleteCurrentNote() {
                if (!state.activeNoteId) return;
                
                if (!confirm('确定要删除此笔记吗？此操作无法撤销。')) return;
                
                const noteIndex = state.notes.findIndex(n => n.id === state.activeNoteId);
                if (noteIndex === -1) return;
                
                state.notes.splice(noteIndex, 1);
                saveNotes();
                
                // 激活下一个笔记或清空编辑器
                if (state.notes.length > 0) {
                    activateNote(state.notes[0].id);
                } else {
                    createDefaultNote();
                }
                
                renderNotesList();
                showToast('笔记已删除');
            }
            
            // 保存笔记到localStorage
            function saveNotes() {
                localStorage.setItem('rt-notes', JSON.stringify(state.notes));
            }
            
            // 格式化日期
            function formatDate(isoString) {
                const date = new Date(isoString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }
            
            // 显示Toast消息
            function showToast(message) {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                dom.toastContainer.appendChild(toast);
                
                // 显示toast
                setTimeout(() => toast.classList.add('show'), 10);
                
                // 3秒后隐藏并移除toast
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            }
            
            // 执行富文本命令
            function execCommand(command, value = null) {
                document.execCommand(command, false, value);
                dom.editor.focus();
                updateToolbarState();
                dom.saveStatus.textContent = '未保存...';
            }
            
            // 插入HTML内容
            function insertHTML(html) {
                execCommand('insertHTML', html);
            }
            
            // 更新工具栏按钮状态
            function updateToolbarState() {
                dom.boldBtn.classList.toggle('active', document.queryCommandState('bold'));
                dom.italicBtn.classList.toggle('active', document.queryCommandState('italic'));
                dom.underlineBtn.classList.toggle('active', document.queryCommandState('underline'));
                dom.strikeBtn.classList.toggle('active', document.queryCommandState('strikeThrough'));
            }
            
            // 在光标位置插入图片
            function insertImage(alt, url) {
                if (!url) return;
                
                const img = document.createElement('img');
                img.src = url;
                img.alt = alt;
                img.style.maxWidth = '100%';
                img.style.borderRadius = '4px';
                img.style.margin = '8px 0';
                
                // 创建包含图片的HTML字符串
                const html = img.outerHTML;
                insertHTML(html);
            }
            
            // 事件监听
            dom.noteTitle.addEventListener('input', () => {
                if (state.activeNoteId) {
                    dom.saveStatus.textContent = '未保存...';
                }
            });
            
            dom.editor.addEventListener('input', () => {
                if (state.activeNoteId) {
                    dom.saveStatus.textContent = '未保存...';
                }
            });
            
            dom.editor.addEventListener('keyup', updateToolbarState);
            dom.editor.addEventListener('mouseup', updateToolbarState);
            
            dom.newNoteBtn.addEventListener('click', createNewNote);
            dom.createFirstNote.addEventListener('click', createNewNote);
            dom.saveNoteBtn.addEventListener('click', saveCurrentNote);
            dom.exportNoteBtn.addEventListener('click', exportCurrentNote);
            dom.deleteNoteBtn.addEventListener('click', deleteCurrentNote);
            dom.themeToggle.addEventListener('click', toggleTheme);
            
            dom.searchNotes.addEventListener('input', (e) => {
                renderNotesList(e.target.value);
            });
            
            // 格式化按钮事件
            dom.boldBtn.addEventListener('click', () => execCommand('bold'));
            dom.italicBtn.addEventListener('click', () => execCommand('italic'));
            dom.underlineBtn.addEventListener('click', () => execCommand('underline'));
            dom.strikeBtn.addEventListener('click', () => execCommand('strikeThrough'));
            dom.ulBtn.addEventListener('click', () => execCommand('insertUnorderedList'));
            dom.olBtn.addEventListener('click', () => execCommand('insertOrderedList'));
            dom.h1Btn.addEventListener('click', () => execCommand('formatBlock', '<h1>'));
            dom.h2Btn.addEventListener('click', () => execCommand('formatBlock', '<h2>'));
            dom.h3Btn.addEventListener('click', () => execCommand('formatBlock', '<h3>'));
            dom.quoteBtn.addEventListener('click', () => execCommand('formatBlock', '<blockquote>'));
            dom.codeBtn.addEventListener('click', () => execCommand('formatBlock', '<pre>'));
            
            // 颜色选择器
            dom.colorBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                dom.colorPalette.classList.toggle('hidden');
            });
            
            // 颜色选择
            dom.colorPalette.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const color = option.dataset.color;
                    execCommand('foreColor', color);
                    dom.colorPalette.classList.add('hidden');
                });
            });
            
            // 点击外部关闭颜色选择器
            document.addEventListener('click', (e) => {
                if (!dom.colorBtn.contains(e.target)) {
                    dom.colorPalette.classList.add('hidden');
                }
            });
            
            // 图片插入功能
            dom.imageBtn.addEventListener('click', () => {
                dom.imageModal.classList.remove('hidden');
                dom.imageUrl.value = '';
                dom.imageAlt.value = '图片描述';
                dom.imageUrl.focus();
            });
            
            dom.cancelImageBtn.addEventListener('click', () => {
                dom.imageModal.classList.add('hidden');
            });
            
            dom.insertImageBtn.addEventListener('click', () => {
                const url = dom.imageUrl.value.trim();
                const alt = dom.imageAlt.value.trim() || '图片';
                
                if (url) {
                    insertImage(alt, url);
                    dom.imageModal.classList.add('hidden');
                    showToast('图片已插入');
                } else {
                    showToast('请输入图片URL');
                }
            });
            
            // 切换主题
            function toggleTheme() {
                const html = document.documentElement;
                const isDark = html.classList.contains('dark');
                
                if (isDark) {
                    html.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                } else {
                    html.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                }
            }
            
            // 自动保存
            setInterval(() => {
                if (state.activeNoteId && dom.saveStatus.textContent === '未保存...') {
                    saveCurrentNote();
                }
            }, 10000);
            
            // 初始化应用
            init();
        });
    </script>
</body>
</html>
