<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion风格富文本编辑器</title>
    <style>
        :root {
            --bg-color: #fff;
            --text-color: #333;
            --border-color: rgba(55, 53, 47, 0.09);
            --sidebar-bg: #fff;
            --navbar-bg: #fff;
            --hover-bg: rgba(55, 53, 47, 0.08);
            --active-bg: rgba(55, 53, 47, 0.12);
            --text-secondary: rgba(55, 53, 47, 0.6);
            --text-placeholder: rgba(55, 53, 47, 0.4);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --shadow-color-hover: rgba(0, 0, 0, 0.15);
            --control-bg: #f0f0f0;
            --control-border: #ddd;
            --danger-color: #e00;
            --danger-hover: rgba(220, 0, 0, 0.1);
            --primary-color: #007bff;
            --toolbar-bg: rgba(245, 245, 245, 0.8);
            --toolbar-hover: rgba(55, 53, 47, 0.08);
            --toolbar-active: rgba(55, 53, 47, 0.12);
            --editor-bg: #fff;
            --editor-placeholder: rgba(55, 53, 47, 0.4);
            --notion-purple: #7e5cef;
            --notion-pink: #e34077;
            --notion-blue: #3ea1d1;
            --notion-green: #44b491;
            --notion-yellow: #f5c34b;
            --notion-orange: #ed8d47;
            --notion-red: #e15256;
            --notion-gray: #9b9b9b;
            --notion-light-gray: #f0f0f0;
            --notion-dark-gray: #444;
            /* 添加文字对比色变量 */
            --editor-text-contrast: #000;
        }
        
        /* 移除自定义的深色模式变量，使用浏览器默认主题 */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
        }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            font-size: 16px;
        }

        /* 顶部导航栏 */
        .navbar {
            height: 45px;
            background: var(--navbar-bg);
            display: flex;
            align-items: center;
            padding: 0 12px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            font-size: 14px;
            box-shadow: 0 1px 0 var(--border-color);
        }

        .nav-left {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .logo {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-color);
        }

        /* 主要布局 */
        .app-container {
            display: flex;
            height: 100vh;
            padding-top: 45px;
        }

        /* 侧边栏 */
        .sidebar {
            width: 240px;
            background: var(--sidebar-bg);
            overflow-y: auto;
            padding: 16px 0;
            flex-shrink: 0;
            font-size: 16px;
            border-right: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 0 16px 8px;
            margin-bottom: 8px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .new-page-btn {
            width: 100%;
            background: none;
            border: none;
            text-align: left;
            padding: 8px 16px;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            position: relative;
            transition: all 0.2s ease;
        }

        .new-page-btn:hover {
            background: var(--hover-bg);
            opacity: 1;
        }

        .new-page-btn::before {
            content: "+";
            margin-right: 8px;
            font-size: 18px;
        }

        .pages-list {
            margin-top: 8px;
        }

        .page-item {
            padding: 6px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            margin: 0 4px;
            display: flex;
            align-items: center;
            color: var(--text-color);
            position: relative;
            transition: all 0.2s ease;
        }

        .page-item:hover {
            background: var(--hover-bg);
        }

        .page-item.active {
            background: var(--active-bg);
            font-weight: 500;
        }

        .page-item::before {
            content: "📄";
            margin-right: 8px;
            font-size: 12px;
        }

        .page-actions {
            margin-left: auto;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .page-item:hover .page-actions {
            opacity: 1;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 12px;
            position: relative;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            background: var(--danger-hover);
        }

        /* 主内容区 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .page-header {
            padding: 32px 10% 8px;
        }

        .page-title-input {
            width: 100%;
            font-size: 40px;
            font-weight: 700;
            border: none;
            outline: none;
            background: transparent;
            color: var(--text-color);
            font-family: inherit;
            line-height: 1.2;
            transition: all 0.2s ease;
        }

        .page-title-input::placeholder {
            color: var(--text-placeholder);
        }

        .page-title-input:focus {
            box-shadow: 0 1px 0 0 var(--border-color);
        }

        /* 字数统计 */
        #wordCount {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            padding: 4px 0;
        }

        .editor-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px 10%;
            background: var(--bg-color);
        }

        /* 自定义编辑器工具栏样式 - Notion风格 */
        .editor-toolbar {
            background: var(--toolbar-bg);
            backdrop-filter: blur(10px);
            border-radius: 6px;
            padding: 4px;
            margin-bottom: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
            transition: all 0.2s ease;
            justify-content: flex-start;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            margin-right: 4px;
            padding-right: 4px;
            border-right: 1px solid var(--border-color);
        }

        .toolbar-group:last-child {
            border-right: none;
            margin-right: 0;
            padding-right: 0;
        }
        
        /* 工具栏分组间距优化 */
        .toolbar-group:not(:last-child) {
            margin-right: 8px;
        }

        .toolbar-btn {
            background: none;
            border: none;
            border-radius: 4px;
            padding: 6px 8px;
            margin: 0 1px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            min-width: 32px;
            height: 32px;
            opacity: 0.7;
        }

        .toolbar-btn:hover {
            background: var(--toolbar-hover);
            opacity: 1;
            transform: translateY(-1px);
        }

        .toolbar-btn.active {
            background: var(--toolbar-active);
            opacity: 1;
            font-weight: bold;
        }

        .toolbar-btn i {
            font-style: normal;
            font-weight: bold;
        }

        .toolbar-separator {
            width: 1px;
            background: var(--border-color);
            margin: 0 4px;
            height: 20px;
        }

        .color-picker {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: var(--control-bg);
            margin: 0 2px;
            transition: all 0.2s ease;
        }

        .color-picker:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        /* 自定义编辑器样式 - Notion风格 */
        .custom-editor {
            min-height: 500px;
            padding: 16px 0;
            outline: none;
            background: var(--bg-color); /* 使用浏览器默认背景 */
            color: var(--text-color); /* 使用浏览器默认文字颜色 */
            font-size: 16px;
            line-height: 1.5;
            caret-color: var(--text-color); /* 光标颜色与文字颜色一致 */
            max-width: 700px;
            margin: 0 auto;
            transition: all 0.2s ease;
        }

        .custom-editor:focus {
            /* 移除焦点边框，使用更自然的样式 */
        }

        .custom-editor:empty::before {
            content: "空行... 按 '/' 查看命令";
            color: var(--text-placeholder);
            font-style: normal;
            pointer-events: none;
        }

        /* 编辑器内容样式 */
        .custom-editor p {
            margin: 0 0 4px 0;
            line-height: 1.5;
        }

        .custom-editor h1,
        .custom-editor h2,
        .custom-editor h3 {
            margin: 16px 0 4px 0;
            font-weight: 600;
            line-height: 1.3;
        }

        .custom-editor h1 {
            font-size: 32px;
        }

        .custom-editor h2 {
            font-size: 24px;
        }

        .custom-editor h3 {
            font-size: 20px;
        }

        .custom-editor ul,
        .custom-editor ol {
            padding-left: 24px;
            margin: 8px 0;
        }

        .custom-editor li {
            margin: 4px 0;
        }

        .custom-editor strong {
            font-weight: 600;
        }

        .custom-editor em {
            font-style: italic;
        }

        .custom-editor u {
            text-decoration: underline;
        }

        .custom-editor a {
            color: #007bff;
            text-decoration: underline;
        }

        @media (prefers-color-scheme: dark) {
            .custom-editor a {
                color: #4da6ff;
            }
        }

        /* 图片样式 - Notion风格 */
        .custom-editor img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 12px 0;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .custom-editor img:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* 图片选中状态 */
        .custom-editor img.selected {
            outline: 2px solid var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-color);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            .page-header, .editor-container {
                padding: 32px 5% 8px;
            }
            
            .custom-editor {
                min-height: 400px;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 0;
                overflow: hidden;
            }
            .page-header, .editor-container {
                padding: 24px 3% 8px;
            }
            
            .editor-toolbar {
                padding: 2px;
            }
            
            .toolbar-btn {
                padding: 4px 6px;
                font-size: 13px;
                min-width: 28px;
                height: 28px;
            }
            
            .custom-editor {
                min-height: 300px;
                padding: 12px 0;
            }
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(55, 53, 47, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(55, 53, 47, 0.3);
        }

        @media (prefers-color-scheme: dark) {
            ::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.2);
            }

            ::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.3);
            }
        }
        
        /* SVG图标样式 */
        .toolbar-btn svg {
            width: 16px;
            height: 16px;
        }
        
        /* Quill风格图标样式 */
        .ql-stroke {
            fill: none;
            stroke: currentColor;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-width: 2;
        }
        
        .ql-fill {
            fill: currentColor;
        }
        
        /* 图标悬停效果 */
        .toolbar-btn:hover svg {
            transform: scale(1.1);
            transition: all 0.2s ease;
        }
        
        /* 活跃状态图标 */
        .toolbar-btn.active .ql-stroke {
            stroke: var(--primary-color);
        }
        
        .toolbar-btn.active .ql-fill {
            fill: var(--primary-color);
        }
        
        /* 优化Notion风格外观 */
        .empty-state {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }
        
        .empty-state-content h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-color);
        }
        
        .empty-state-content p {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }
        
        /* 页面列表优化 */
        .page-item {
            transition: all 0.2s ease;
        }
        
        /* 按钮样式优化 */
        .new-page-btn {
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        /* 编辑器内容优化 */
        .custom-editor {
            font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
        }
        
        /* 标题样式优化 */
        .custom-editor h1 {
            font-size: 40px;
            line-height: 1.2;
            margin-top: 24px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .custom-editor h2 {
            font-size: 32px;
            line-height: 1.2;
            margin-top: 20px;
            margin-bottom: 6px;
            font-weight: 600;
        }
        
        .custom-editor h3 {
            font-size: 24px;
            line-height: 1.2;
            margin-top: 16px;
            margin-bottom: 4px;
            font-weight: 600;
        }
        
        /* 列表样式优化 */
        .custom-editor ul, .custom-editor ol {
            padding-left: 32px;
        }
        
        .custom-editor li {
            margin: 2px 0;
        }
        
        /* 链接样式优化 */
        .custom-editor a {
            color: #007bff;
            text-decoration: none;
            border-bottom: 1px solid rgba(0, 123, 255, 0.3);
            transition: all 0.2s ease;
        }
        
        .custom-editor a:hover {
            border-bottom: 1px solid #007bff;
        }
        
        @media (prefers-color-scheme: dark) {
            .custom-editor a {
                color: #4da6ff;
                border-bottom: 1px solid rgba(77, 166, 255, 0.3);
            }
            
            .custom-editor a:hover {
                border-bottom: 1px solid #4da6ff;
            }
        }
        
        /* Notion风格颜色按钮 */
        .color-btn {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid transparent;
            cursor: pointer;
            margin: 0 2px;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .color-btn:hover {
            transform: scale(1.2);
            border-color: var(--border-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .color-btn.purple { background-color: var(--notion-purple); }
        .color-btn.pink { background-color: var(--notion-pink); }
        .color-btn.blue { background-color: var(--notion-blue); }
        .color-btn.green { background-color: var(--notion-green); }
        .color-btn.yellow { background-color: var(--notion-yellow); }
        .color-btn.orange { background-color: var(--notion-orange); }
        .color-btn.red { background-color: var(--notion-red); }
        .color-btn.gray { background-color: var(--notion-gray); }
        
        /* Notion风格代码块 */
        .custom-editor pre {
            background: var(--control-bg);
            border-radius: 4px;
            padding: 12px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 12px 0;
        }
        
        @media (prefers-color-scheme: dark) {
            .custom-editor pre {
                background: #333;
            }
        }
        
        /* Notion风格引用块 */
        .custom-editor blockquote {
            border-left: 3px solid var(--notion-gray);
            padding-left: 16px;
            margin: 12px 0;
            color: var(--text-secondary);
        }
        
        /* Notion风格分隔线 */
        .custom-editor hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 24px 0;
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        /* 悬停效果 */
        .page-item, .new-page-btn, .toolbar-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* 页面项悬停效果 */
        .page-item:hover {
            transform: translateX(2px);
        }
        
        /* Notion风格表格 */
        .custom-editor table {
            border-collapse: collapse;
            width: 100%;
            margin: 12px 0;
        }
        
        .custom-editor table th,
        .custom-editor table td {
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            text-align: left;
        }
        
        .custom-editor table th {
            background-color: var(--notion-light-gray);
            font-weight: 600;
        }
        
        /* Notion风格待办事项 */
        .custom-editor .todo-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        
        .custom-editor .todo-checkbox {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            cursor: pointer;
        }
        
        .custom-editor .todo-text {
            flex: 1;
        }
        
        .custom-editor .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: var(--text-secondary);
        }
        
        /* Notion风格卡片 */
        .custom-editor .notion-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            background: var(--toolbar-bg);
        }
        
        /* Notion风格标签 */
        .custom-editor .notion-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin: 0 4px;
            background: var(--notion-light-gray);
        }
        
        /* Notion风格Callout */
        .custom-editor .notion-callout {
            display: flex;
            align-items: flex-start;
            padding: 12px 16px;
            border-radius: 4px;
            background: var(--notion-light-gray);
            margin: 12px 0;
        }
        
        .custom-editor .notion-callout-icon {
            margin-right: 12px;
            font-size: 18px;
        }
        
        .custom-editor .notion-callout-content {
            flex: 1;
        }
        
        /* Notion风格切换列表 */
        .custom-editor .toggle-list {
            margin: 4px 0;
        }
        
        .custom-editor .toggle-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 2px 0;
        }
        
        .custom-editor .toggle-icon {
            margin-right: 8px;
            transition: transform 0.2s ease;
        }
        
        .custom-editor .toggle-icon.expanded {
            transform: rotate(90deg);
        }
        
        .custom-editor .toggle-content {
            margin-left: 24px;
            display: none;
        }
        
        .custom-editor .toggle-content.expanded {
            display: block;
        }
        
        /* Notion风格分隔符 */
        .custom-editor .notion-divider {
            height: 1px;
            background: var(--border-color);
            margin: 24px 0;
        }
        
        /* Notion风格按钮 */
        .custom-editor .notion-button {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            background: var(--notion-blue);
            color: white;
            font-size: 14px;
            cursor: pointer;
            border: none;
            margin: 4px 0;
        }
        
        .custom-editor .notion-button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->
    <nav class="navbar">
        <div class="nav-left">
            <div class="logo">Notion记事本</div>
        </div>
    </nav>
    
    <!-- 主要内容 -->
    <div class="app-container">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">工作区</div>
                <button class="new-page-btn" id="newPageBtn">新建页面</button>
            </div>
            <div class="pages-list" id="pagesList"></div>
        </aside>
        
        <!-- 主内容区 -->
        <main class="main-content">
            <div class="page-header">
                <input
                    type="text"
                    class="page-title-input"
                    id="pageTitle"
                    placeholder="未命名"
                >
                <!-- 字数统计显示区域 -->
                <div id="wordCount">字符数: 0 | 单词数: 0</div>
            </div>
            <div class="editor-container" id="editorContainer">
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-content">
                        <h2>欢迎使用Notion记事本</h2>
                        <p>创建您的第一个页面，开始记录想法、制定计划或整理信息。</p>
                        <button class="new-page-btn" id="createPageBtn">创建页面</button>
                    </div>
                </div>
                <div id="editorWrapper" style="display: none;">
                    <div id="toolbar" class="editor-toolbar"></div>
                    <div id="editor" class="custom-editor" contenteditable="true"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // 页面数据管理
        let pages = JSON.parse(localStorage.getItem('notepad_pages')) || [];
        let currentPageId = null;

        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            initializeToolbar();
            renderPagesList();
            setupEventListeners();
            
            // 如果有页面，加载第一个页面
            if (pages.length > 0) {
                loadPage(pages[0].id);
            }
        });

        // 初始化工具栏
        function initializeToolbar() {
            const toolbar = document.getElementById('toolbar');
            if (!toolbar) return;
            
            toolbar.innerHTML = `
                <div class="toolbar-group">
                    <button class="toolbar-btn" data-command="bold" title="粗体">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="none" stroke="currentColor" stroke-width="1.5" d="M6.5 4.5v15M6.5 4.5h4c2.5 0 4.5 2 4.5 4.5s-2 4.5-4.5 4.5h-4M11 13h3.5c2 0 3.5 1.5 3.5 3.5s-1.5 3.5-3.5 3.5h-3.5"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" data-command="italic" title="斜体">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M10 4v3h1.8l-2 14H8v3h6v-3h-1.8l2-14H16V4h-6v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" data-command="underline" title="下划线">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" data-command="insertUnorderedList" title="项目符号列表">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" data-command="insertOrderedList" title="编号列表">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M3 5h2v2H3V5zm0 6h2v2H3v-2zm0 6h2v2H3v-2zm4-12h14v2H7V5zm0 6h14v2H7v-2zm0 6h14v2H7v-2z"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-group">
                    <input type="color" class="font-color-picker" title="字体颜色" value="#000000">
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" data-command="createLink" title="插入链接">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5zm-6 8H7c-1.65 0-3 1.35-3 3s1.35 3 3 3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-2zm-3-4h6v2H8v-2z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" data-command="insertImage" title="插入图片">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z"/>
                        </svg>
                    </button>
                </div>
            `;
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 新建页面按钮
            document.getElementById('newPageBtn')?.addEventListener('click', createNewPage);
            document.getElementById('createPageBtn')?.addEventListener('click', createNewPage);
            
            // 页面标题输入
            document.getElementById('pageTitle')?.addEventListener('input', updatePageTitle);
            
            // 工具栏按钮
            document.getElementById('toolbar')?.addEventListener('click', function(e) {
                const btn = e.target.closest('.toolbar-btn');
                if (btn && btn.dataset.command) {
                    handleToolbarCommand(btn.dataset.command);
                }
            });
            
            // 字体颜色选择器
            document.querySelector('.font-color-picker')?.addEventListener('input', function(e) {
                const color = e.target.value;
                applyFontColor(color);
            });
            
            // 编辑器内容变化
            document.getElementById('editor')?.addEventListener('input', function() {
                saveCurrentPage();
                updateWordCount();
            });
            
            // 编辑器焦点事件
            document.getElementById('editor')?.addEventListener('focus', updateToolbarButtonState);
            document.getElementById('editor')?.addEventListener('blur', updateToolbarButtonState);
            
            // 键盘快捷键
            document.addEventListener('keydown', function(e) {
                // Ctrl+B 粗体
                if (e.ctrlKey && e.key === 'b') {
                    e.preventDefault();
                    document.execCommand('bold', false, null);
                    updateToolbarButtonState();
                }
                // Ctrl+I 斜体
                if (e.ctrlKey && e.key === 'i') {
                    e.preventDefault();
                    document.execCommand('italic', false, null);
                    updateToolbarButtonState();
                }
                // Ctrl+U 下划线
                if (e.ctrlKey && e.key === 'u') {
                    e.preventDefault();
                    document.execCommand('underline', false, null);
                    updateToolbarButtonState();
                }
            });
            
            // 编辑器点击事件（处理切换列表等交互元素）
            document.getElementById('editor')?.addEventListener('click', function(e) {
                // 处理切换列表
                const toggleHeader = e.target.closest('.toggle-header');
                if (toggleHeader) {
                    const icon = toggleHeader.querySelector('.toggle-icon');
                    const content = toggleHeader.nextElementSibling;
                    
                    icon.classList.toggle('expanded');
                    content.classList.toggle('expanded');
                }
            });
        }

        // 处理工具栏命令
        function handleToolbarCommand(command) {
            switch (command) {
                case 'createLink':
                    const url = prompt('请输入链接地址:');
                    if (url) {
                        document.execCommand('createLink', false, url);
                    }
                    break;
                case 'insertImage':
                    const imgUrl = prompt('请输入图片地址:');
                    if (imgUrl) {
                        document.execCommand('insertImage', false, imgUrl);
                    }
                    break;
                default:
                    document.execCommand(command, false, null);
            }
            updateToolbarButtonState();
            saveCurrentPage();
        }

        // 应用字体颜色
        function applyFontColor(color) {
            const selection = window.getSelection();
            if (!selection.toString()) {
                alert('请先选择要改变颜色的文本');
                return;
            }
            
            // 直接应用字体颜色，不改变背景色
            document.execCommand('foreColor', false, color);
            saveCurrentPage();
        }

        // 更新工具栏按钮状态
        function updateToolbarButtonState() {
            const buttons = document.querySelectorAll('.toolbar-btn[data-command]');
            buttons.forEach(btn => {
                const command = btn.dataset.command;
                if (command && document.queryCommandState && document.queryCommandState(command)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // 创建新页面
        function createNewPage() {
            const newPage = {
                id: Date.now().toString(),
                title: '未命名',
                content: '',
                createdAt: new Date().toISOString()
            };
            
            pages.unshift(newPage);
            savePages();
            renderPagesList();
            loadPage(newPage.id);
        }

        // 渲染页面列表
        function renderPagesList() {
            const pagesList = document.getElementById('pagesList');
            if (!pagesList) return;
            
            pagesList.innerHTML = pages.map(page => `
                <div class="page-item ${page.id === currentPageId ? 'active' : ''}" data-id="${page.id}">
                    <span>${page.title || '未命名'}</span>
                    <div class="page-actions">
                        <button class="delete-btn" data-id="${page.id}">删除</button>
                    </div>
                </div>
            `).join('');
            
            // 添加删除按钮事件监听
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const pageId = this.dataset.id;
                    deletePage(pageId);
                });
            });
            
            // 添加页面项点击事件监听
            document.querySelectorAll('.page-item').forEach(item => {
                item.addEventListener('click', function() {
                    const pageId = this.dataset.id;
                    loadPage(pageId);
                });
            });
        }

        // 加载页面
        function loadPage(pageId) {
            const page = pages.find(p => p.id === pageId);
            if (!page) return;
            
            currentPageId = pageId;
            
            // 显示编辑器
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('editorWrapper').style.display = 'block';
            
            // 设置页面标题
            document.getElementById('pageTitle').value = page.title || '未命名';
            
            // 设置页面内容
            document.getElementById('editor').innerHTML = page.content || '';
            
            // 更新页面列表
            renderPagesList();
            
            // 更新字数统计
            updateWordCount();
        }

        // 更新页面标题
        function updatePageTitle() {
            const title = document.getElementById('pageTitle').value;
            const page = pages.find(p => p.id === currentPageId);
            if (page) {
                page.title = title;
                savePages();
                renderPagesList();
            }
        }

        // 保存当前页面
        function saveCurrentPage() {
            const page = pages.find(p => p.id === currentPageId);
            if (page) {
                page.content = document.getElementById('editor').innerHTML;
                page.title = document.getElementById('pageTitle').value;
                savePages();
            }
        }

        // 删除页面
        function deletePage(pageId) {
            if (pages.length <= 1) {
                alert('至少需要保留一个页面');
                return;
            }
            
            if (confirm('确定要删除这个页面吗？')) {
                pages = pages.filter(p => p.id !== pageId);
                savePages();
                renderPagesList();
                
                // 如果删除的是当前页面，加载第一个页面
                if (pageId === currentPageId) {
                    if (pages.length > 0) {
                        loadPage(pages[0].id);
                    } else {
                        // 显示空状态
                        document.getElementById('emptyState').style.display = 'flex';
                        document.getElementById('editorWrapper').style.display = 'none';
                        currentPageId = null;
                    }
                }
            }
        }

        // 保存页面数据到本地存储
        function savePages() {
            try {
                localStorage.setItem('notepad_pages', JSON.stringify(pages));
            } catch (e) {
                console.error('保存页面数据失败:', e);
            }
        }

        // 更新字数统计
        function updateWordCount() {
            const editor = document.getElementById('editor');
            if (!editor) return;
            
            const text = editor.innerText || '';
            const charCount = text.length;
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            
            document.getElementById('wordCount').textContent = `字符数: ${charCount} | 单词数: ${wordCount}`;
        }
    </script>
</body>
</html>
